<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOVA ADMIN | Control Panel</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-color: #0E1116;
            --bg-secondary: #151A21;
            --text-main: #F9FAFB;
            --text-muted: #94A3B8;
            --accent-glow: #2DD4BF;
            --secondary-glow: #22D3EE;
            --danger: #ef4444;
            --success: #10b981;
            --border: rgba(45, 212, 191, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- LOGIN SCREEN --- */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 2000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        .login-box {
            background: var(--bg-secondary); padding: 3rem; width: 100%; max-width: 400px;
            border-radius: 12px; border: 1px solid var(--border); text-align: center;
            box-shadow: 0 0 40px rgba(45, 212, 191, 0.1);
        }

        /* --- LAYOUT --- */
        #dashboard { display: none; width: 100%; height: 100%; }
        
        .sidebar {
            width: 260px; background: var(--bg-secondary); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 1.5rem;
        }

        .main-content {
            flex: 1; padding: 2rem; overflow-y: auto; background: var(--bg-color);
        }

        /* --- COMPONENTS --- */
        .logo { font-size: 1.5rem; font-weight: 800; color: #fff; margin-bottom: 2rem; letter-spacing: -1px; }
        .logo span { color: var(--accent-glow); }

        .nav-btn {
            width: 100%; padding: 12px 15px; margin-bottom: 8px;
            background: transparent; border: none; border-radius: 8px;
            color: var(--text-muted); text-align: left; font-size: 0.95rem; cursor: pointer;
            transition: 0.3s; display: flex; align-items: center; gap: 10px;
        }
        .nav-btn:hover, .nav-btn.active { background: rgba(45, 212, 191, 0.1); color: var(--accent-glow); }
        
        .section-header { margin-bottom: 2rem; border-bottom: 1px solid var(--border); padding-bottom: 1rem; }
        .section-title { font-size: 1.8rem; font-weight: 700; color: #fff; }

        /* --- FORMS --- */
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; color: var(--text-muted); font-size: 0.9rem; }
        
        input, textarea, select {
            width: 100%; padding: 12px; background: rgba(0,0,0,0.3);
            border: 1px solid var(--border); border-radius: 6px;
            color: #fff; font-family: inherit; outline: none; transition: 0.3s;
        }
        input:focus, textarea:focus, select:focus { border-color: var(--accent-glow); box-shadow: 0 0 10px rgba(45, 212, 191, 0.1); }

        /* --- ANIMATED BUTTONS --- */
        .btn {
            padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: 700; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden;
            text-transform: uppercase; letter-spacing: 1px; font-size: 0.85rem;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        
        .btn:disabled { opacity: 0.7; cursor: not-allowed; filter: grayscale(0.5); }
        .btn:not(:disabled):active { transform: scale(0.98); }

        .btn-primary { 
            background: var(--accent-glow); color: #0E1116; width: 100%; 
            box-shadow: 0 4px 15px rgba(45, 212, 191, 0.2);
        }
        .btn-primary:not(:disabled):hover { 
            box-shadow: 0 8px 25px rgba(45, 212, 191, 0.4); 
            transform: translateY(-2px);
            background: var(--secondary-glow);
        }

        .btn-danger { 
            background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.5); 
        }
        .btn-danger:not(:disabled):hover { 
            background: #ef4444; color: #fff; 
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3); 
            transform: translateY(-2px); 
        }
        
        .btn-sm { padding: 6px 12px; font-size: 0.75rem; width: auto; }

        /* --- LIST ITEMS --- */
        .item-list { display: grid; gap: 1rem; }
        .list-item {
            background: var(--bg-secondary); padding: 1rem; border-radius: 8px; border: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            transition: 0.3s;
        }
        .list-item:hover { border-color: var(--accent-glow); }
        .item-info h4 { color: #fff; margin-bottom: 0.2rem; }
        .item-info span { font-size: 0.85rem; color: var(--text-muted); }
        
        /* --- MESSAGE CARD --- */
        .msg-card { background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 1rem; }
        .msg-header { display: flex; justify-content: space-between; margin-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 0.5rem; }
        .msg-date { font-size: 0.8rem; color: var(--text-muted); }

        /* --- TABS --- */
        .tab-content { display: none; animation: fadeEffect 0.4s; }
        .tab-content.active { display: block; }
        @keyframes fadeEffect { from {opacity: 0;} to {opacity: 1;} }

        /* --- LOADING SPINNER --- */
        .spinner {
            border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid #fff;
            border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite;
            display: none; /* Hidden by default */
        }
        .btn.loading .spinner { display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <!-- 1. LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-box">
            <div class="logo">NOVA<span>-ADMIN</span></div>
            <p style="color: var(--text-muted); margin-bottom: 1.5rem;">Authenticate to access control.</p>
            <div class="form-group">
                <input type="email" id="email" placeholder="Admin Email">
            </div>
            <div class="form-group">
                <input type="password" id="password" placeholder="Password">
            </div>
            <button class="btn btn-primary" id="login-btn" onclick="login()">
                <span class="btn-text">INITIALIZE</span>
                <span class="spinner"></span>
            </button>
            <p id="login-error" style="color: var(--danger); margin-top: 1rem; font-size: 0.9rem;"></p>
        </div>
    </div>

    <!-- 2. DASHBOARD -->
    <div id="dashboard">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="logo">NOVA<span>-FORGE</span></div>
            <button class="nav-btn active" onclick="switchTab('hero')"><i class="fas fa-home"></i> Hero Section</button>
            <button class="nav-btn" onclick="switchTab('about')"><i class="fas fa-user"></i> About Section</button>
            <button class="nav-btn" onclick="switchTab('skills')"><i class="fas fa-code"></i> Skills</button>
            <button class="nav-btn" onclick="switchTab('projects')"><i class="fas fa-project-diagram"></i> Projects</button>
            <button class="nav-btn" onclick="switchTab('certs')"><i class="fas fa-certificate"></i> Certifications</button>
            <button class="nav-btn" onclick="switchTab('messages')"><i class="fas fa-envelope"></i> Messages</button>
            
            <div style="margin-top: 2rem; border-top: 1px solid var(--border); padding-top: 1rem;">
                <button class="nav-btn" onclick="switchTab('system')"><i class="fas fa-cog"></i> System / Data</button>
            </div>

            <div style="margin-top: auto;">
                <button class="nav-btn" style="color: var(--danger);" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            
            <!-- HERO TAB -->
            <div id="hero" class="tab-content active">
                <div class="section-header"><h2 class="section-title">Hero Configuration</h2></div>
                <div class="form-group">
                    <label>Greeting Text</label>
                    <input type="text" id="hero-greeting">
                </div>
                <div class="form-group">
                    <label>Your Name</label>
                    <input type="text" id="hero-name">
                </div>
                <div class="form-group">
                    <label>Services / Roles (Comma separated)</label>
                    <input type="text" id="hero-services" placeholder="e.g. Full-Stack Developer, UI Designer">
                </div>
                <h4 style="color:#fff; margin: 1.5rem 0 1rem;">Social Links</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>GitHub URL</label>
                        <input type="text" id="hero-github">
                    </div>
                    <div class="form-group">
                        <label>LinkedIn URL</label>
                        <input type="text" id="hero-linkedin">
                    </div>
                    <div class="form-group">
                        <label>WhatsApp URL</label>
                        <input type="text" id="hero-whatsapp">
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="text" id="hero-email">
                    </div>
                </div>
                <button class="btn btn-primary" id="btn-hero" onclick="saveHero()">
                    <span class="btn-text">UPDATE HERO</span>
                    <span class="spinner"></span>
                </button>
            </div>

            <!-- ABOUT TAB -->
            <div id="about" class="tab-content">
                <div class="section-header"><h2 class="section-title">About Configuration</h2></div>
                <div class="form-group">
                    <label>Headline</label>
                    <input type="text" id="about-headline">
                </div>
                <div class="form-group">
                    <label>Bio / Description</label>
                    <textarea id="about-bio" rows="6"></textarea>
                </div>
                <h4 style="color:#fff; margin: 1.5rem 0 1rem;">Statistics</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                    <div>
                        <label>Stat 1 Number</label>
                        <input type="text" id="about-stat1-num" placeholder="e.g. 4+">
                        <label style="margin-top:5px">Stat 1 Label</label>
                        <input type="text" id="about-stat1-label" placeholder="Certifications">
                    </div>
                    <div>
                        <label>Stat 2 Number</label>
                        <input type="text" id="about-stat2-num" placeholder="e.g. 5+">
                        <label style="margin-top:5px">Stat 2 Label</label>
                        <input type="text" id="about-stat2-label" placeholder="Projects Built">
                    </div>
                    <div>
                        <label>Stat 3 Number</label>
                        <input type="text" id="about-stat3-num" placeholder="e.g. MERN">
                        <label style="margin-top:5px">Stat 3 Label</label>
                        <input type="text" id="about-stat3-label" placeholder="Tech Stack">
                    </div>
                </div>
                <button class="btn btn-primary" id="btn-about" onclick="saveAbout()" style="margin-top:1.5rem;">
                    <span class="btn-text">UPDATE ABOUT</span>
                    <span class="spinner"></span>
                </button>
            </div>

            <!-- SKILLS TAB -->
            <div id="skills" class="tab-content">
                <div class="section-header"><h2 class="section-title">Manage Skills</h2></div>
                
                <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                    <h4 style="color:#fff; margin-bottom:1rem;">Add New Skill</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 100px; gap: 1rem; align-items: end;">
                        <div>
                            <label>Skill Name</label>
                            <input type="text" id="new-skill-name" placeholder="e.g. React">
                        </div>
                        <div>
                            <label>Icon</label>
                            <select id="new-skill-icon">
                                <option value="fab fa-html5">HTML5</option>
                                <option value="fab fa-css3-alt">CSS3</option>
                                <option value="fab fa-js">JavaScript</option>
                                <option value="fab fa-react">React</option>
                                <option value="fab fa-node">Node.js</option>
                                <option value="fab fa-python">Python</option>
                                <option value="fab fa-java">Java</option>
                                <option value="fab fa-git-alt">Git</option>
                                <option value="fab fa-unity">Unity</option>
                                <option value="fas fa-cube">Blender/3D</option>
                                <option value="fas fa-database">Database</option>
                                <option value="fas fa-code">Code/General</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" id="btn-add-skill" onclick="addSkill()">
                            <span class="btn-text">ADD</span><span class="spinner"></span>
                        </button>
                    </div>
                </div>

                <div id="skills-list" class="item-list">
                    <!-- Skills injected here -->
                </div>
            </div>

            <!-- PROJECTS TAB -->
            <div id="projects" class="tab-content">
                <div class="section-header"><h2 class="section-title">Manage Projects</h2></div>
                
                <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                    <h4 style="color:#fff; margin-bottom:1rem;">Add Project</h4>
                    <div class="form-group">
                        <label>Main Title</label>
                        <input type="text" id="proj-title">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Subtitle / Tags</label>
                            <input type="text" id="proj-tags" placeholder="e.g. React, Firebase">
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <select id="proj-cat">
                                <option value="Web">Web Development</option>
                                <option value="Game">Game Development</option>
                                <option value="3D">3D Modeling</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="proj-desc" rows="3"></textarea>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Code Link</label>
                            <input type="text" id="proj-link-code">
                        </div>
                        <div class="form-group">
                            <label>Demo Link</label>
                            <input type="text" id="proj-link-demo">
                        </div>
                    </div>
                    <button class="btn btn-primary" id="btn-add-proj" onclick="addProject()">
                        <span class="btn-text">ADD PROJECT</span><span class="spinner"></span>
                    </button>
                </div>

                <div id="projects-list" class="item-list"></div>
            </div>

            <!-- CERTIFICATES TAB -->
            <div id="certs" class="tab-content">
                <div class="section-header"><h2 class="section-title">Manage Certifications</h2></div>
                
                <div style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                    <h4 style="color:#fff; margin-bottom:1rem;">Add Certificate</h4>
                    <div class="form-group">
                        <label>Certificate Title</label>
                        <input type="text" id="cert-title">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Issuer</label>
                            <input type="text" id="cert-issuer">
                        </div>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="text" id="cert-date" placeholder="e.g. Dec 2025">
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>Credential Link</label>
                            <input type="text" id="cert-link">
                        </div>
                        <div class="form-group">
                            <label>Icon</label>
                            <select id="cert-icon">
                                <option value="fas fa-award">Award (Generic)</option>
                                <option value="fab fa-microsoft">Microsoft</option>
                                <option value="fab fa-google">Google</option>
                                <option value="fab fa-aws">AWS</option>
                                <option value="fas fa-university">University</option>
                                <option value="fas fa-certificate">Certificate</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="btn-add-cert" onclick="addCert()">
                        <span class="btn-text">ADD CERTIFICATE</span><span class="spinner"></span>
                    </button>
                </div>

                <div id="certs-list" class="item-list"></div>
            </div>

            <!-- MESSAGES TAB -->
            <div id="messages" class="tab-content">
                <div class="section-header"><h2 class="section-title">Inbox</h2></div>
                <div id="messages-list">
                    <p style="color: var(--text-muted);">Loading messages...</p>
                </div>
            </div>

            <!-- SYSTEM / DATA TAB -->
            <div id="system" class="tab-content">
                <div class="section-header"><h2 class="section-title">System & Data</h2></div>
                
                <div style="background: var(--bg-secondary); padding: 2rem; border-radius: 8px; border: 1px solid var(--border);">
                    <h3 style="color: var(--accent-glow); margin-bottom: 1rem;">Initialize Database</h3>
                    <p style="color: var(--text-muted); margin-bottom: 1.5rem;">
                        If your Admin Panel lists (Skills, Projects, etc.) are empty, clicking this button will populate your database with the default data from your website (Alan Bose, Skills, Projects, etc.).
                        <br><br>
                        <strong>Note:</strong> This will overwrite existing data. Use this only if you want to reset or start fresh.
                    </p>
                    <button class="btn btn-primary" id="btn-load-defaults" onclick="loadDefaults()">
                        <span class="btn-text">LOAD DEFAULT DATA</span><span class="spinner"></span>
                    </button>
                </div>
            </div>

        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion, arrayRemove, onSnapshot, collection, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // --- FIREBASE CONFIG (YOURS) ---
        const firebaseConfig = {
            apiKey: "AIzaSyC3SAkK1AOM08-OfRtLtOWUfHQuI9179ew",
            authDomain: "nova-forge-14e0d.firebaseapp.com",
            projectId: "nova-forge-14e0d",
            storageBucket: "nova-forge-14e0d.firebasestorage.app",
            messagingSenderId: "869423934249",
            appId: "1:869423934249:web:027f97a90bef4dface6538"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const contentRef = doc(db, "website", "content");

        // --- DEFAULT DATA (MATCHES INDEX.HTML) ---
        const DEFAULT_DATA = {
            hero: {
                greeting: "Hello, Welcome to My Forge",
                name: "ALAN BOSE",
                services: ["Full-Stack Developer", "Game Developer"],
                socials: {
                    github: "https://github.com/AlanBose-dev",
                    linkedin: "https://www.linkedin.com/in/alan-bose",
                    whatsapp: "https://wa.me/917907173621",
                    email: "alanbose701@gmail.com"
                }
            },
            about: {
                headline: "Building Simple and Meaningful Web Experiences",
                bio: "I am a Computer Science student with a strong interest in frontend web development. I enjoy turning ideas and designs into responsive and user-friendly websites using HTML, CSS, and JavaScript.\n\nCurrently, I am improving my skills through hands-on projects and professional courses to prepare for real-world development work.",
                stats: [
                    { num: "4+", label: "Certifications" },
                    { num: "5+", label: "Projects Built" },
                    { num: "MERN", label: "Tech Stack" }
                ]
            },
            skills: [
                { name: "HTML5", icon: "fab fa-html5" },
                { name: "CSS3", icon: "fab fa-css3-alt" },
                { name: "JavaScript", icon: "fab fa-js" },
                { name: "React", icon: "fab fa-react" },
                { name: "Unity", icon: "fab fa-unity" },
                { name: "Blender", icon: "fas fa-cube" },
                { name: "Git", icon: "fab fa-git-alt" }
            ],
            projects: [
                { title: "E-Commerce Dashboard", category: "React", subtitle: "Firebase", desc: "A full-featured dashboard for managing products, orders, and analytics.", link_code: "#", link_demo: "#" },
                { title: "Space Explorer", category: "Unity", subtitle: "C#", desc: "A 2D platformer game developed in Unity featuring custom physics.", link_code: "#", link_demo: "#" }
            ],
            certificates: [
                { title: "Full Stack Foundation", issuer: "Microsoft", date: "Dec 2025", link: "pdf/fullstack-cert.pdf", icon: "fas fa-award" }
            ]
        };

        // --- AUTHENTICATION ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'flex';
                initRealtimeListeners();
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
            }
        });

        window.login = async () => {
            setLoading('login-btn', true);
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            try {
                await signInWithEmailAndPassword(auth, email, pass);
            } catch (err) {
                document.getElementById('login-error').innerText = err.message;
            } finally {
                setLoading('login-btn', false);
            }
        };

        window.logout = () => signOut(auth);

        // --- REALTIME DATA SYNC ---
        let currentData = {};

        function initRealtimeListeners() {
            onSnapshot(contentRef, (doc) => {
                if (doc.exists()) {
                    currentData = doc.data();
                    populateHero(currentData.hero);
                    populateAbout(currentData.about);
                    renderSkills(currentData.skills || []);
                    renderProjects(currentData.projects || []);
                    renderCerts(currentData.certificates || []);
                }
            });

            const msgsQuery = query(collection(db, "messages"), orderBy("date", "desc"));
            onSnapshot(msgsQuery, (snapshot) => {
                const container = document.getElementById('messages-list');
                container.innerHTML = '';
                if(snapshot.empty) container.innerHTML = '<p>No messages yet.</p>';
                
                snapshot.forEach(doc => {
                    const msg = doc.data();
                    const date = new Date(msg.date).toLocaleString();
                    const div = document.createElement('div');
                    div.className = 'msg-card';
                    div.innerHTML = `
                        <div class="msg-header">
                            <strong style="color:#fff;">${msg.name} <span style="color:var(--text-muted); font-weight:400;">(${msg.email})</span></strong>
                            <span class="msg-date">${date}</span>
                        </div>
                        <p style="color: #fff;">${msg.message}</p>
                    `;
                    container.appendChild(div);
                });
            });
        }

        // --- POPULATE FORMS ---
        function populateHero(hero) {
            if(!hero) return;
            document.getElementById('hero-greeting').value = hero.greeting || '';
            document.getElementById('hero-name').value = hero.name || '';
            document.getElementById('hero-services').value = hero.services ? hero.services.join(', ') : '';
            
            // Populate Socials
            if(hero.socials) {
                document.getElementById('hero-github').value = hero.socials.github || '';
                document.getElementById('hero-linkedin').value = hero.socials.linkedin || '';
                document.getElementById('hero-whatsapp').value = hero.socials.whatsapp || '';
                document.getElementById('hero-email').value = hero.socials.email || '';
            }
        }

        function populateAbout(about) {
            if(!about) return;
            document.getElementById('about-headline').value = about.headline || '';
            document.getElementById('about-bio').value = about.bio || '';
            
            // Populate Stats
            if(about.stats && about.stats.length >= 3) {
                document.getElementById('about-stat1-num').value = about.stats[0].num;
                document.getElementById('about-stat1-label').value = about.stats[0].label;
                document.getElementById('about-stat2-num').value = about.stats[1].num;
                document.getElementById('about-stat2-label').value = about.stats[1].label;
                document.getElementById('about-stat3-num').value = about.stats[2].num;
                document.getElementById('about-stat3-label').value = about.stats[2].label;
            }
        }

        // --- RENDER LISTS ---
        function renderSkills(skills) {
            const list = document.getElementById('skills-list');
            list.innerHTML = '';
            skills.forEach((s, idx) => {
                list.innerHTML += `
                    <div class="list-item">
                        <div class="item-info">
                            <h4><i class="${s.icon}" style="color:var(--accent-glow); margin-right:8px;"></i> ${s.name}</h4>
                        </div>
                        <button class="btn btn-danger btn-sm" onclick="removeItem('skills', ${idx}, this)"><i class="fas fa-trash"></i></button>
                    </div>
                `;
            });
        }

        function renderProjects(projects) {
            const list = document.getElementById('projects-list');
            list.innerHTML = '';
            projects.forEach((p, idx) => {
                list.innerHTML += `
                    <div class="list-item">
                        <div class="item-info">
                            <h4>${p.title} <span style="font-size:0.8rem; border:1px solid var(--accent-glow); padding:2px 6px; border-radius:4px; color:var(--accent-glow); margin-left:10px;">${p.category}</span></h4>
                            <span>${p.subtitle}</span>
                        </div>
                        <button class="btn btn-danger btn-sm" onclick="removeItem('projects', ${idx}, this)"><i class="fas fa-trash"></i></button>
                    </div>
                `;
            });
        }

        function renderCerts(certs) {
            const list = document.getElementById('certs-list');
            list.innerHTML = '';
            certs.forEach((c, idx) => {
                list.innerHTML += `
                    <div class="list-item">
                        <div class="item-info">
                            <h4><i class="${c.icon}" style="margin-right:5px;"></i> ${c.title}</h4>
                            <span>${c.issuer} â€¢ ${c.date}</span>
                        </div>
                        <button class="btn btn-danger btn-sm" onclick="removeItem('certificates', ${idx}, this)"><i class="fas fa-trash"></i></button>
                    </div>
                `;
            });
        }

        // --- SAVE FUNCTIONS ---
        window.saveHero = async () => {
            setLoading('btn-hero', true);
            const svcs = document.getElementById('hero-services').value.split(',').map(s => s.trim());
            const socials = {
                github: document.getElementById('hero-github').value,
                linkedin: document.getElementById('hero-linkedin').value,
                whatsapp: document.getElementById('hero-whatsapp').value,
                email: document.getElementById('hero-email').value
            };
            
            await setDoc(contentRef, {
                hero: {
                    greeting: document.getElementById('hero-greeting').value,
                    name: document.getElementById('hero-name').value,
                    services: svcs,
                    socials: socials
                }
            }, { merge: true });
            setLoading('btn-hero', false);
            alert('Hero Updated!');
        };

        window.saveAbout = async () => {
            setLoading('btn-about', true);
            const stats = [
                { num: document.getElementById('about-stat1-num').value, label: document.getElementById('about-stat1-label').value },
                { num: document.getElementById('about-stat2-num').value, label: document.getElementById('about-stat2-label').value },
                { num: document.getElementById('about-stat3-num').value, label: document.getElementById('about-stat3-label').value }
            ];
            
            await setDoc(contentRef, {
                about: {
                    headline: document.getElementById('about-headline').value,
                    bio: document.getElementById('about-bio').value,
                    stats: stats
                }
            }, { merge: true });
            setLoading('btn-about', false);
            alert('About Updated!');
        };

        window.loadDefaults = async () => {
            if(!confirm("This will overwrite existing database data with default website content. Continue?")) return;
            setLoading('btn-load-defaults', true);
            await setDoc(contentRef, DEFAULT_DATA, { merge: true });
            setLoading('btn-load-defaults', false);
            alert('Defaults Loaded! Check the tabs.');
        };

        // --- CRUD OPERATIONS ---
        window.addSkill = async () => {
            const newSkill = {
                name: document.getElementById('new-skill-name').value,
                icon: document.getElementById('new-skill-icon').value
            };
            if(!newSkill.name) return alert('Name required');
            
            setLoading('btn-add-skill', true);
            await setDoc(contentRef, { skills: arrayUnion(newSkill) }, { merge: true });
            setLoading('btn-add-skill', false);
            document.getElementById('new-skill-name').value = '';
        };

        window.addProject = async () => {
            const newProj = {
                title: document.getElementById('proj-title').value,
                subtitle: document.getElementById('proj-tags').value,
                category: document.getElementById('proj-cat').value,
                desc: document.getElementById('proj-desc').value,
                link_code: document.getElementById('proj-link-code').value,
                link_demo: document.getElementById('proj-link-demo').value
            };
            if(!newProj.title) return alert('Title required');
            
            setLoading('btn-add-proj', true);
            await setDoc(contentRef, { projects: arrayUnion(newProj) }, { merge: true });
            setLoading('btn-add-proj', false);
            document.getElementById('proj-title').value = '';
            document.getElementById('proj-desc').value = '';
        };

        window.addCert = async () => {
            const newCert = {
                title: document.getElementById('cert-title').value,
                issuer: document.getElementById('cert-issuer').value,
                date: document.getElementById('cert-date').value,
                link: document.getElementById('cert-link').value,
                icon: document.getElementById('cert-icon').value
            };
            if(!newCert.title) return alert('Title required');
            
            setLoading('btn-add-cert', true);
            await setDoc(contentRef, { certificates: arrayUnion(newCert) }, { merge: true });
            setLoading('btn-add-cert', false);
            document.getElementById('cert-title').value = '';
        };

        window.removeItem = async (field, index, btn) => {
            if(!confirm('Are you sure you want to delete this item?')) return;
            
            // Show loading on the specific delete button
            const originalHtml = btn.innerHTML;
            btn.innerHTML = '<span class="spinner" style="width:12px; height:12px;"></span>';
            btn.disabled = true;

            const docSnap = await getDoc(contentRef);
            if(docSnap.exists()) {
                const data = docSnap.data();
                const array = data[field];
                const itemToRemove = array[index];
                
                await setDoc(contentRef, {
                    [field]: arrayRemove(itemToRemove)
                }, { merge: true });
            }
        };

        // --- UTILS ---
        function setLoading(btnId, isLoading) {
            const btn = document.getElementById(btnId);
            if(isLoading) {
                btn.classList.add('loading');
                btn.disabled = true;
            } else {
                btn.classList.remove('loading');
                btn.disabled = false;
            }
        }

        window.switchTab = (tabId) => {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            const btns = document.querySelectorAll('.nav-btn');
            btns.forEach(btn => {
                if(btn.textContent.toLowerCase().includes(tabId)) btn.classList.add('active');
            });
        };
    </script>
</body>
</html>